<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Casino House Control - PRO</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #121212; color: white; display: flex; flex-direction: column; align-items: center; min-height: 100vh; margin: 0; padding: 20px; box-sizing: border-box; }
        
        .container { width: 100%; max-width: 500px; display: grid; gap: 20px; filter: blur(5px); pointer-events: none; transition: 0.3s; }
        .container.unlocked { filter: none; pointer-events: all; }

        .card { background: #1e1e1e; padding: 25px; border-radius: 15px; border: 1px solid #333; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .card h2 { margin-top: 0; color: #d4af37; text-transform: uppercase; letter-spacing: 2px; font-size: 18px; border-bottom: 1px solid #333; padding-bottom: 10px; margin-bottom: 20px; }
        
        label { display: block; margin-top: 15px; color: #aaa; font-size: 14px; text-align: left; }
        select, input { padding: 12px; width: 100%; font-size: 18px; background: #2a2a2a; color: white; border: 1px solid #d4af37; margin: 5px 0; box-sizing: border-box; border-radius: 5px; }
        
        button { padding: 15px; width: 100%; background: linear-gradient(45deg, #d4af37, #f1c40f); color: black; border: none; font-weight: bold; cursor: pointer; border-radius: 5px; font-size: 16px; margin-top: 15px; transition: 0.2s; }
        button:hover { filter: brightness(1.1); transform: scale(1.02); }

        .monitor-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-top: 10px; }
        .mon-box { background: #2a2a2a; padding: 10px; border-radius: 5px; border: 1px solid #444; position: relative; text-align: center; height: 60px; display: flex; flex-direction: column; justify-content: center; transition: 0.3s; }
        
        .mon-num { font-size: 11px; color: #666; position: absolute; top: 4px; left: 6px; font-weight: bold; }
        .mon-amt { font-size: 18px; font-weight: bold; color: #555; }
        
        .mon-box.active { border-color: #ffcc00; background: #3a3a2a; box-shadow: 0 0 15px rgba(255, 204, 0, 0.15); }
        .mon-box.active .mon-amt { color: #00e676; text-shadow: 0 0 5px rgba(0, 230, 118, 0.4); }
        .mon-box.active .mon-num { color: #d4af37; }

        .back { display: block; margin-top: 20px; color: #666; text-decoration: none; font-size: 14px; }
        .back:hover { color: #d4af37; }

        #securityOverlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; z-index: 9999;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
        }
        .lock-box { text-align: center; width: 300px; }
        .lock-icon { font-size: 50px; margin-bottom: 20px; }

        /* --- NEW: Pulse Animation for Warning --- */
        @keyframes pulse {
            0% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.8; transform: scale(0.98); }
            100% { opacity: 1; transform: scale(1); }
        }
    </style>
</head>
<body>
    <script>
    // 1. DISABLE RIGHT-CLICK
    document.addEventListener('contextmenu', function(e) {
        e.preventDefault();
    });

    // 2. DISABLE KEYBOARD SHORTCUTS (F12, Ctrl+Shift+I, Ctrl+U, etc.)
    document.onkeydown = function(e) {
        if (event.keyCode == 123) { // F12
            return false;
        }
        if (e.ctrlKey && e.shiftKey && e.keyCode == 'I'.charCodeAt(0)) { // Ctrl+Shift+I
            return false;
        }
        if (e.ctrlKey && e.shiftKey && e.keyCode == 'C'.charCodeAt(0)) { // Ctrl+Shift+C
            return false;
        }
        if (e.ctrlKey && e.shiftKey && e.keyCode == 'J'.charCodeAt(0)) { // Ctrl+Shift+J
            return false;
        }
        if (e.ctrlKey && e.keyCode == 'U'.charCodeAt(0)) { // Ctrl+U (View Source)
            return false;
        }
    }

    // 3. DEBUGGER TRAP (Freezes browser if DevTools is opened)
    setInterval(function() {
        // This will pause execution if the user opens the console
        (function(){debugger;})(); 
    }, 100);
</script>

    <div id="securityOverlay">
        <div class="lock-box">
            <div class="lock-icon">üîí</div>
            <h3 style="color:#d4af37">ADMIN ACCESS</h3>
            <input type="password" id="adminPass" placeholder="Enter Password" style="text-align:center;">
            <button onclick="unlockPanel()">UNLOCK</button>
            <p id="lockError" style="color:red; display:none; margin-top:10px;">Access Denied</p>
        </div>
    </div>

    <div class="container" id="mainContainer">
        
        <div class="card" style="border-color: #29b6f6;">
            <h2 style="color: #29b6f6;">üë§ CREATE PLAYER</h2>
            <input type="number" id="newPhone" placeholder="Player WhatsApp Number">
            <input type="text" id="newPass" placeholder="Set Password">
            <button onclick="createPlayer()" style="background: linear-gradient(45deg, #29b6f6, #0288d1);">GENERATE ID</button>
            <p id="createMsg" style="color: #29b6f6; display: none; margin-top: 10px;">User Created Successfully!</p>
        </div>
        
        <div id="timerWarning" style="display:none; background: #ff1744; color: white; padding: 15px; border-radius: 10px; text-align: center; font-weight: bold; font-size: 20px; animation: pulse 1s infinite; margin-bottom: 10px; box-shadow: 0 0 15px #ff1744;">
            ‚ö†Ô∏è SPINNING IN 15 SECONDS
        </div>

        <div class="card">
            <h2>üõë RIGGING CONTROL</h2>
            <label>Force Next Number (1-12):</label>
            <input type="number" id="numInput" min="1" max="12" placeholder="Leave empty for Random">
            
            <label>Payout Multiplier:</label>
            <select id="xInput">
                <option value="1">1x (Standard)</option>
                <option value="2">2x (Double)</option>
                <option value="3">3x (Triple)</option>
                <option value="5">5x (Jackpot)</option>
            </select>

            <button onclick="saveControl()">ARM SYSTEM</button>
            
            <button onclick="applySmartBias()" style="background: linear-gradient(45deg, #ff1744, #d50000); margin-top: 10px; color: white; border: 1px solid #ff5252;">
                üß† DEMO: APPLY HOUSE BIAS
            </button>

            <p id="status" style="height: 20px; font-weight: bold; color: #888; margin-top:15px;">System Standby</p>
        </div>

        <div class="card" style="border-color: #00e676;">
            <h2 style="color: #00e676; border-color: #333;">üìä 24H HOUSE VOLUME</h2>
            <div style="font-size: 32px; font-weight: bold; color: white; margin-top: 10px;">
                <span id="adminVolDisplay">Loading...</span>
            </div>
            <p style="color: #666; font-size: 12px; margin-top: 5px;">Total Net Volume (Bets - Payouts)</p>
        </div>

        <div class="card">
            <h2>üí∞ LIVE LIABILITY</h2>
            <div class="monitor-grid" id="monitorGrid"></div>
            <p style="color:#666; font-size:12px; margin-top:10px;">Shows ONLY active bets for current spin</p>
        </div>
        
        <button onclick="window.location.href='ids.html'" style="background: linear-gradient(45deg, #9c27b0, #ab47bc); color: white; margin-top: 10px; border-color: #7b1fa2;">
            üìã TO ID PAGE
        </button>
        
        <a href="index.html" class="back">‚Üê Back to Game Table</a>
    </div>
      

   <script>
        // 1. FIREBASE SETUP
        const firebaseConfig = {
            apiKey: "AIzaSyAuaE-ZsqFLnYUrGNF2VaIeDdzrDA-mVyE",
            authDomain: "id-spin.firebaseapp.com",
            databaseURL: "https://id-spin-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "id-spin",
            storageBucket: "id-spin.firebasestorage.app",
            messagingSenderId: "968364255642",
            appId: "1:968364255642:web:216707fa28f7f351927223"
        };
        
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // 2. UNLOCK PANEL FUNCTION
        function unlockPanel() {
            const p = document.getElementById('adminPass').value;
            if(p === 'admin123') { 
                document.getElementById('securityOverlay').style.display = 'none';
                document.getElementById('mainContainer').classList.add('unlocked');
            } else {
                document.getElementById('lockError').style.display = 'block';
            }
        }

        // 3. üëë CREATE PLAYER FUNCTION (The Magical Part)
        // This attaches the function to the window to make sure the button can find it
        window.createPlayer = async function() {
    const phone = document.getElementById('newPhone').value.trim();
    const pass = document.getElementById('newPass').value.trim();
    const msg = document.getElementById('createMsg');

    if (!phone || phone.length < 10) {
        alert("‚ö†Ô∏è Error: Please enter a valid 10-digit Phone Number.");
        return;
    }
    if (!pass) {
        alert("‚ö†Ô∏è Error: Please set a password.");
        return;
    }

    try {
        // Use await to ensure the database writes before proceeding
        await db.ref('users/' + phone).set({
            password: pass,
            active: true,
            balance: 0, // Initializing balance is recommended
            created_at: firebase.database.ServerValue.TIMESTAMP
        });

        // SUCCESS Feedback
        alert(`‚úÖ SUCCESS!\n\nPlayer ID: ${phone}\nPassword: ${pass}`);
        
        // Clear inputs
        document.getElementById('newPhone').value = "";
        document.getElementById('newPass').value = "";

        if(msg) {
            msg.style.display = 'block';
            setTimeout(() => { msg.style.display = 'none'; }, 5000);
        }
    } catch (error) {
        console.error("Database Write Error:", error);
        alert("‚ùå FAILED TO CREATE ID: " + error.message);
    }
}

        // 4. SAVE GAME CONTROLS (Rigging)
        window.saveControl = function() {
            const num = document.getElementById('numInput').value;
            const x = document.getElementById('xInput').value;
            let target = num === "" ? 0 : parseInt(num);
            
            if ((target !== 0) && (target < 1 || target > 12)) { 
                alert("Enter number 1-12 or leave empty."); 
                return; 
            }

            db.ref('house_control').set({
                number: target, 
                multiplier: parseInt(x),
                timestamp: Date.now()
            }).then(() => {
                const dispText = target === 0 ? "RANDOM" : `#${target}`;
                document.getElementById('status').innerHTML = `ARMED: <span style="color:#00e676">${dispText} @ ${x}X</span>`;
            });
        }

        // 5. MONITOR 24H VOLUME
        db.ref('house_stats/daily_volume').on('value', (snapshot) => {
            let val = snapshot.val() || 0;
            const el = document.getElementById('adminVolDisplay');
            el.innerText = '‚Çπ' + val.toLocaleString();
            el.style.color = val >= 0 ? "#00e676" : "#ff1744";
        });

        // 6. LIVE BETS MONITOR
        window.liveBetTotals = {}; // <-- NEW: Store totals globally for the Bias AI

        function initMonitor() {
            db.ref('current_round_bets').on('value', (snapshot) => {
                const allBets = snapshot.val() || {};
                let monitorTotals = {}; 
                for(let i=1; i<=12; i++) monitorTotals[i] = 0;

                Object.values(allBets).forEach(playerSlip => {
                    for (const [num, amount] of Object.entries(playerSlip)) {
                        if(amount) monitorTotals[num] += parseInt(amount);
                    }
                });
                
                window.liveBetTotals = monitorTotals; // <-- NEW: Save the live math
                renderGrid(monitorTotals);
            });
        }
        

        function renderGrid(totals) {
            const grid = document.getElementById('monitorGrid');
            grid.innerHTML = '';
            for(let i=1; i<=12; i++) {
                const amt = totals[i] || 0;
                const activeClass = amt > 0 ? 'active' : '';
                grid.innerHTML += `
                    <div class="mon-box ${activeClass}">
                        <span class="mon-num">#${i}</span>
                        <div class="mon-amt">${amt.toLocaleString()}</div>
                    </div>
                `;
            }
        }
        initMonitor();

        // 7. TIMER WARNING
        db.ref('game_state').on('value', (snapshot) => {
            const data = snapshot.val();
            if (!data) return;
            const warningEl = document.getElementById('timerWarning');
            
            if (data.status === "BETTING" && data.time_left <= 15 && data.time_left > 0) {
                warningEl.style.display = 'block';
                warningEl.style.background = '#ff1744'; 
                warningEl.innerText = `‚ö†Ô∏è SPINNING IN ${data.time_left} SECONDS`;
            } else if (data.status === "SPINNING") {
                 warningEl.style.display = 'block';
                 warningEl.style.background = '#d4af37'; 
                 warningEl.style.color = 'black';
                 warningEl.innerText = `üé∞ WHEEL IS SPINNING...`;
            } else {
                warningEl.style.display = 'none';
            }
        });
        // 8. üß† EDUCATIONAL DEMO: SMART HOUSE BIAS ALGORITHM
        window.applySmartBias = function() {
            const totals = window.liveBetTotals;
            
            // Step 1: Find the absolute lowest total bet amount on the board
            let minBet = Infinity;
            for (let i = 1; i <= 12; i++) {
                if (totals[i] < minBet) {
                    minBet = totals[i];
                }
            }
            
            // Step 2: Group all numbers that tie for this lowest liability
            // (e.g., If no one bet on 3, 7, and 9, they all tie at ‚Çπ0)
            let bestHouseNumbers = [];
            for (let i = 1; i <= 12; i++) {
                if (totals[i] === minBet) {
                    bestHouseNumbers.push(i);
                }
            }
            
            // Step 3: Pick a random number from the House's best options
            // This ensures it doesn't just pick "1" every time it's empty, avoiding suspicion.
            const biasNumber = bestHouseNumbers[Math.floor(Math.random() * bestHouseNumbers.length)];
            
            // Step 4: Inject it into the UI and auto-arm the system
            document.getElementById('numInput').value = biasNumber;
            document.getElementById('xInput').value = "1"; // Force 1x payout to protect the house
            
            saveControl(); // Uses your existing function to fire it to Firebase
            
            // Step 5: Explain the math to the demonstrator/student
            alert(`üéì BIAS DEMO APPLIED:\n\nThe algorithm analyzed all active player bets and selected #${biasNumber}.\n\nThis outcome guarantees the lowest possible payout for the House (Liability: ‚Çπ${minBet * 10}).`);
        }
    </script>
</body>
</html>